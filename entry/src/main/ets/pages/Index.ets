import { router } from '@kit.ArkUI';
import { display } from '@kit.ArkUI';

// æŒ‰é’®çŠ¶æ€æ¥å£
interface ButtonState {
  isHovered: boolean;
  isPressed: boolean;
  scale: number;
  translateY: number;
  emojiRotate: number;
  emojiScale: number;
}

@Entry
@Component
struct Index {
  @State isAudioEnabled: boolean = true
  @State gridCols: number = 2
  @State screenWidth: number = 0
  @State screenHeight: number = 0
  
  // æŒ‰é’®åŠ¨ç”»çŠ¶æ€
  @State buttonStates: ButtonState[] = [
    { isHovered: false, isPressed: false, scale: 1.0, translateY: 0, emojiRotate: 0, emojiScale: 1.0 },
    { isHovered: false, isPressed: false, scale: 1.0, translateY: 0, emojiRotate: 0, emojiScale: 1.0 },
    { isHovered: false, isPressed: false, scale: 1.0, translateY: 0, emojiRotate: 0, emojiScale: 1.0 },
    { isHovered: false, isPressed: false, scale: 1.0, translateY: 0, emojiRotate: 0, emojiScale: 1.0 },
    { isHovered: false, isPressed: false, scale: 1.0, translateY: 0, emojiRotate: 0, emojiScale: 1.0 },
    { isHovered: false, isPressed: false, scale: 1.0, translateY: 0, emojiRotate: 0, emojiScale: 1.0 },
    { isHovered: false, isPressed: false, scale: 1.0, translateY: 0, emojiRotate: 0, emojiScale: 1.0 }
  ]

  aboutToAppear() {
    this.detectDevice()
  }

  // æ£€æµ‹è®¾å¤‡ç±»å‹å’Œå±å¹•å°ºå¯¸
  detectDevice() {
    const displayInfo = display.getDefaultDisplaySync()
    this.screenWidth = displayInfo.width
    this.screenHeight = displayInfo.height
    
    // å›ºå®šä¸º2åˆ—å¸ƒå±€ï¼Œä¸ç®¡ä»€ä¹ˆè®¾å¤‡
    this.gridCols = 2
  }

  build() {
    Stack() {
      // å¤©ç©ºåˆ°ç´«è‰²æ¸å˜èƒŒæ™¯
      Column()
        .width('100%')
        .height('100%')
        .linearGradient({
          direction: GradientDirection.Bottom,
          colors: [[0x87CEEB, 0.0], [0xE0E6FF, 0.5], [0xC8B2DB, 1.0]]
        })

      Column() {
        // é¡¶éƒ¨æ§åˆ¶åŒºåŸŸ
        Column() {
          Text('æ¬¢è¿æ¥åˆ°æ•°å­—ä¹å›­')
            .fontSize(30)  // å¯¹åº”Reactçš„text-3xl
            .fontWeight(FontWeight.Bold)
            .fontColor('#374151')
            .textAlign(TextAlign.Center)
            .margin({ bottom: 24 })
            
          // å£°éŸ³æ§åˆ¶å¤§æŒ‰é’®
          Row() {
            this.SoundButton()
          }
          .justifyContent(FlexAlign.Center)
          .margin({ bottom: 16 })
            
          Text(this.isAudioEnabled ? 'â™ª å£°éŸ³å·²å¼€å¯' : 'âœ• å£°éŸ³å·²å…³é—­')
            .fontSize(14)
            .fontWeight(FontWeight.Medium)
            .fontColor(this.isAudioEnabled ? '#16a34a' : '#6b7280')
            .textAlign(TextAlign.Center)
            .animation({ duration: 300 })
        }
        .width('100%')
        .alignItems(HorizontalAlign.Center)
        .margin({ top: 40, bottom: 48 })  // å¯¹åº”Reactçš„mb-12

        // åŠŸèƒ½æŒ‰é’®ç½‘æ ¼
        Column() {
          GridRow({ columns: 2, gutter: { x: 16, y: 16 } }) {  // å›ºå®š2åˆ—å¸ƒå±€
            // è¯­éŸ³è®¡ç®—å™¨
            GridCol() {
              this.CartoonButton(
                0,
                'è¯­éŸ³è®¡ç®—å™¨',
                'ğŸ§®',
                '#fb923c',
                () => { 
                  console.info('ç‚¹å‡»äº†è¯­éŸ³è®¡ç®—å™¨');
                  // TODO: è·³è½¬åˆ°è®¡ç®—å™¨é¡µé¢
                }
              )
            }
            
            // æ•°å­¦ç»ƒä¹ 
            GridCol() {
              this.CartoonButton(
                1,
                'æ•°å­¦ç»ƒä¹ ',
                'ğŸ“š',
                '#34d399',
                () => { 
                  console.info('ç‚¹å‡»äº†æ•°å­¦ç»ƒä¹ ');
                  // TODO: è·³è½¬åˆ°ç»ƒä¹ é¡µé¢
                }
              )
            }
            
            // æ•°å­¦å¤§å†’é™©
            GridCol() {
              this.CartoonButton(
                2,
                'æ•°å­¦å¤§å†’é™©',
                'ğŸ®',
                '#a855f7',
                () => { 
                  console.info('ç‚¹å‡»äº†æ•°å­¦å¤§å†’é™©');
                  // TODO: è·³è½¬åˆ°æ¸¸æˆé¡µé¢
                }
              )
            }
            
            // å­¦æ•°å­¦
            GridCol() {
              this.CartoonButton(
                3,
                'å­¦æ•°å­¦',
                'ğŸ±',
                '#f43f5e',
                () => { 
                  console.info('ç‚¹å‡»äº†å­¦æ•°å­¦');
                  // TODO: è·³è½¬åˆ°å¯è§†åŒ–æ•°å­¦é¡µé¢
                }
              )
            }
            
            // å­¦ä¹ æŠ¥å‘Š
            GridCol() {
              this.CartoonButton(
                4,
                'å­¦ä¹ æŠ¥å‘Š',
                'ğŸ“Š',
                '#22d3ee',
                () => { 
                  console.info('ç‚¹å‡»äº†å­¦ä¹ æŠ¥å‘Š');
                  // TODO: è·³è½¬åˆ°æŠ¥å‘Šé¡µé¢
                }
              )
            }
            
            // è¯­éŸ³é€‰æ‹©
            GridCol() {
              this.CartoonButton(
                5,
                'è¯­éŸ³é€‰æ‹©',
                'ğŸ¤',
                '#ec4899',
                () => { 
                  console.info('ç‚¹å‡»äº†è¯­éŸ³é€‰æ‹©');
                  // TODO: è·³è½¬åˆ°è¯­éŸ³é€‰æ‹©é¡µé¢
                }
              )
            }
            
            // è®¾ç½®
            GridCol() {
              this.CartoonButton(
                6,
                'è®¾ç½®',
                'âš™ï¸',
                '#64748b',
                () => { 
                  console.info('ç‚¹å‡»äº†è®¾ç½®');
                  // TODO: è·³è½¬åˆ°è®¾ç½®é¡µé¢
                }
              )
            }
          }
          .width('100%')
          .constraintSize({ maxWidth: 600 })  // é™åˆ¶æœ€å¤§å®½åº¦
          .alignSelf(ItemAlign.Center)  // ç½‘æ ¼å±…ä¸­
        }
        .width('100%')
        .alignItems(HorizontalAlign.Center)  // å†…å®¹å±…ä¸­å¯¹é½
      }
      .width('100%')
      .height('100%')
      .padding({ left: 24, right: 24 })
      .alignItems(HorizontalAlign.Center)  // æ•´ä½“å†…å®¹å±…ä¸­
      
      // æµ®åŠ¨è£…é¥°å…ƒç´ 
      this.FloatingDecorations()
    }
    .width('100%')
    .height('100%')
  }

  // å£°éŸ³æ§åˆ¶æŒ‰é’®
  @Builder
  SoundButton() {
    Button() {
      Text(this.isAudioEnabled ? 'ğŸ”Š' : 'ğŸ”‡')
        .fontSize(24)
        .animation({ duration: 200, curve: Curve.EaseInOut })
    }
    .type(ButtonType.Circle)
    .width(70)
    .height(70)
    .borderRadius(35)
    .linearGradient({
      direction: GradientDirection.Bottom,
      colors: this.isAudioEnabled ? 
        [['#10b981', 0.0], ['#059669', 1.0]] : 
        [['#9ca3af', 0.0], ['#6b7280', 1.0]]
    })
    .shadow({
      radius: 8,
      color: this.isAudioEnabled ? '#10b98140' : '#6b728040',
      offsetX: 0,
      offsetY: 2
    })
    .onClick(() => {
      this.isAudioEnabled = !this.isAudioEnabled
    })
  }

  // ç®€æ´å¯çˆ±æŒ‰é’®ç»„ä»¶
  @Builder
  CartoonButton(index: number, title: string, emoji: string, color: string, onTap: () => void) {
    Button() {
      Column({ space: 12 }) {
        Text(emoji)
          .fontSize(48)
          .shadow({
            radius: 8,
            color: '#00000020',
            offsetX: 0,
            offsetY: 2
          })
          .animation({ duration: 300, curve: Curve.EaseOut })
          
        Text(title)
          .fontSize(16)
          .fontWeight(FontWeight.Medium)
          .fontColor(Color.White)
          .textAlign(TextAlign.Center)
          .maxLines(2)
          .shadow({
            radius: 4,
            color: '#00000030',
            offsetX: 0,
            offsetY: 1
          })
      }
      .justifyContent(FlexAlign.Center)
      .alignItems(HorizontalAlign.Center)
      .width('100%')
      .height('100%')
    }
    .type(ButtonType.Normal)
    .width(140)
    .height(140)
    .borderRadius(28)
    .linearGradient({
      direction: GradientDirection.Bottom,
      colors: [[color, 0.0], [color + 'dd', 1.0]]
    })
    .border({ width: 2, color: '#ffffff50', style: BorderStyle.Solid })
    .backgroundBlurStyle(BlurStyle.Thin)
    .shadow({
      radius: 12,
      color: color + '40',
      offsetX: 0,
      offsetY: 4
    })
    .scale({ 
      x: this.buttonStates[index].isPressed ? 0.95 : (this.buttonStates[index].isHovered ? 1.05 : 1.0), 
      y: this.buttonStates[index].isPressed ? 0.95 : (this.buttonStates[index].isHovered ? 1.05 : 1.0) 
    })
    .animation({ duration: 200, curve: Curve.EaseOut })
    .onClick(() => {
      onTap()
    })
    .onTouch((event: TouchEvent) => {
      if (event.type === TouchType.Down) {
        this.buttonStates[index].isPressed = true
      } else if (event.type === TouchType.Up || event.type === TouchType.Cancel) {
        this.buttonStates[index].isPressed = false
      }
    })
    .onHover((isHover: boolean) => {
      this.buttonStates[index].isHovered = isHover
    })
  }
  
  // æµ®åŠ¨è£…é¥°å…ƒç´ 
  @Builder
  FloatingDecorations() {
    // åº•éƒ¨è£…é¥°
    Text('â­')
      .fontSize(32)
      .position({ x: 16, y: this.screenHeight - 120 })
      .animation({ 
        duration: 2000, 
        curve: Curve.EaseInOut, 
        iterations: -1, 
        playMode: PlayMode.Alternate 
      })
      
    Text('ğŸŒŸ')
      .fontSize(32)
      .position({ x: this.screenWidth - 64, y: this.screenHeight - 120 })
      .animation({ 
        duration: 2000, 
        curve: Curve.EaseInOut, 
        iterations: -1, 
        playMode: PlayMode.Alternate,
        delay: 500
      })
      
    // é¡¶éƒ¨è£…é¥°
    Text('ğŸˆ')
      .fontSize(24)
      .position({ x: 40, y: 80 })
      .animation({ 
        duration: 3000, 
        curve: Curve.EaseInOut, 
        iterations: -1, 
        playMode: PlayMode.Alternate 
      })
      
    Text('ğŸ¨')
      .fontSize(24)
      .position({ x: this.screenWidth - 90, y: 128 })
      .animation({ 
        duration: 3000, 
        curve: Curve.EaseInOut, 
        iterations: -1, 
        playMode: PlayMode.Alternate,
        delay: 1000
      })
      
    Text('ğŸŒˆ')
      .fontSize(20)
      .position({ x: 32, y: this.screenHeight * 0.5 })
      .animation({ 
        duration: 3000, 
        curve: Curve.EaseInOut, 
        iterations: -1, 
        playMode: PlayMode.Alternate,
        delay: 2000
      })
  }
}